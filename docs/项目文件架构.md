# Engram å·¥ç¨‹ç›®å½•ç»“æ„æŒ‡å—

> æ­¤ç›®å½•ç»“æ„åŸºäº **React + Vite + TypeScript**ï¼Œé‡‡ç”¨ **DDD (é¢†åŸŸé©±åŠ¨è®¾è®¡)** åˆ†å±‚ï¼Œå°†æ ¸å¿ƒé€»è¾‘ä¸ UI å½»åº•è§£è€¦ã€‚

---

## ğŸ“ ç›®å½•ç»“æ„æ€»è§ˆ

```
/
â”œâ”€â”€ assets/                    # é™æ€èµ„æº
â”‚   â””â”€â”€ logo/                  # Logo æ–‡ä»¶
â”‚       â”œâ”€â”€ Engram_icon.svg    # å›¾æ ‡ (æ‚¬æµ®çƒ)
â”‚       â”œâ”€â”€ Engram_logo.svg    # å®Œæ•´ logo (é¢æ¿å¤´éƒ¨)
â”‚       â””â”€â”€ Engram_textlogo.svg# æ–‡å­— logo
â”‚
â”œâ”€â”€ src/
â”‚   â”‚
â”‚   â”‚   // â•â•â• L4: åŸºç¡€è®¾æ–½å±‚ (Infrastructure) â•â•â•
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”‚   â”œâ”€â”€ bus/               # äº‹ä»¶æ€»çº¿ (RxJS)
â”‚   â”‚   â”‚   â””â”€â”€ EventBus.ts    
â”‚   â”‚   â”œâ”€â”€ storage/           # æ•°æ®åº“é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ DexieDB.ts     # IndexedDB å®ä¾‹ (Graph Storage)
â”‚   â”‚   â”‚   â””â”€â”€ VectorDB.ts    # Voy å®ä¾‹ (Vector Storage)
â”‚   â”‚   â”œâ”€â”€ logger/            # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â”‚   â””â”€â”€ index.ts       # ç»Ÿä¸€æ—¥å¿—ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ adapter/           # å¤–éƒ¨ç³»ç»Ÿé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ STBridge.ts    # SillyTavern API æ¡¥æ¥ (jQuery Hooks)
â”‚   â”‚       â””â”€â”€ LLMAdapter.ts  # ç»Ÿä¸€ LLM è°ƒç”¨æ¥å£
â”‚   â”‚
â”‚   â”‚   // â•â•â• L3: é¢†åŸŸæ ¸å¿ƒå±‚ (Domain / Core) â•â•â•
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ pipeline/          # æ•°æ®å¤„ç†æµæ°´çº¿
â”‚   â”‚   â”‚   â”œâ”€â”€ Pipeline.ts    # ç®¡é“æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ steps/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Summarizer.ts  # LLM æ€»ç»“ & å®ä½“æå–
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GraphBuilder.ts# æ„å»ºå›¾è°±èŠ‚ç‚¹ä¸è¾¹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Vectorizer.ts  # è®¡ç®— Embedding
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ rag/               # RAG æ ¸å¿ƒç®—æ³•
â”‚   â”‚   â”‚   â”œâ”€â”€ Retriever.ts   # æ··åˆæ£€ç´¢å™¨ (Graph + Vector)
â”‚   â”‚   â”‚   â””â”€â”€ Reranker.ts    # é‡æ’åºé€»è¾‘
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ manager/           # çŠ¶æ€ç®¡ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ BrainManager.ts # åˆ†è„‘é€»è¾‘ (Context Switching)
â”‚   â”‚   â”‚   â””â”€â”€ ConfigManager.ts# é…ç½®æŒä¹…åŒ–
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ types/             # é¢†åŸŸæ¨¡å‹å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ graph.d.ts     # EntityNode, EventNode å®šä¹‰
â”‚   â”‚       â””â”€â”€ events.d.ts    # ç³»ç»Ÿäº‹ä»¶å®šä¹‰
â”‚   â”‚
â”‚   â”‚   // â•â•â• L2: åº”ç”¨å±‚ (Application / Hooks) â•â•â•
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useGraphData.ts    # è®¢é˜…å›¾è°±æ•°æ® (ç”¨äº React Flow)
â”‚   â”‚   â”œâ”€â”€ useMemoryStream.ts # è®¢é˜…è®°å¿†æµ (ç”¨äºåˆ—è¡¨å±•ç¤º)
â”‚   â”‚   â””â”€â”€ useIngestion.ts    # æ§åˆ¶æ‘„å…¥çŠ¶æ€
â”‚   â”‚
â”‚   â”‚   // â•â•â• L1: è¡¨ç°å±‚ (Presentation / UI) â•â•â•
â”‚   â”œâ”€â”€ views/                 # è§†å›¾ç»„ä»¶ï¼ˆæ¯ä¸ªè§†å›¾ç‹¬ç«‹æ ·å¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ Layout/            # å¸ƒå±€å®¹å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx     
â”‚   â”‚   â”‚   â””â”€â”€ Sidebar/       
â”‚   â”‚   â”œâ”€â”€ Dashboard/         # ä»ªè¡¨ç›˜
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      
â”‚   â”‚   â”‚   â””â”€â”€ components/    # å­ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DevLog/            # å¼€å‘æ—¥å¿—
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      
â”‚   â”‚   â”‚   â””â”€â”€ LogEntryItem.tsx
â”‚   â”‚   â”œâ”€â”€ APIPresets/        # API é¢„è®¾ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts       # ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ components/    # ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ FormField/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ PresetCard/
â”‚   â”‚   â”‚       â”œâ”€â”€ LLMPresetForm/
â”‚   â”‚   â”‚       â”œâ”€â”€ VectorConfigForm/
â”‚   â”‚   â”‚       â””â”€â”€ RerankConfigForm/
â”‚   â”‚   â”œâ”€â”€ MemoryStream/      # è®°å¿†æµ
â”‚   â”‚   â”œâ”€â”€ GraphView/         # å›¾è°±å¯è§†åŒ–
â”‚   â”‚   â”œâ”€â”€ Brain/             # å¤§è„‘æ§åˆ¶å°
â”‚   â”‚   â””â”€â”€ Settings/          # è®¾ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx                # æ ¹ç»„ä»¶ + è·¯ç”±
â”‚   â”œâ”€â”€ main.tsx               # å…¥å£ (Mount Logic)
â”‚   â”‚
â”‚   â”‚   // â•â•â• æ ·å¼ç³»ç»Ÿ â•â•â•
â”‚   â””â”€â”€ styles/
â”‚       â”œâ”€â”€ main.css           # ä¸»å…¥å£ï¼ˆå¯¼å…¥å…¶ä»–æ¨¡å— + æ ¸å¿ƒå¸ƒå±€ï¼‰
â”‚       â””â”€â”€ variables.css      # Design Token ç³»ç»Ÿ
â”‚
â”œâ”€â”€ dist/                      # æ„å»ºè¾“å‡º
â”‚   â”œâ”€â”€ index.js               # æ‰“åŒ…åçš„ JS
â”‚   â””â”€â”€ style.css              # æ‰“åŒ…åçš„ CSS
â”‚
â”œâ”€â”€ docs/                      # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ manifest.json              # ST æ’ä»¶æ¸…å•
â”œâ”€â”€ vite.config.ts             # Vite é…ç½® (Library Mode)
â”œâ”€â”€ tailwind.config.js         # Tailwind é…ç½® (eg- å‰ç¼€)
â”œâ”€â”€ postcss.config.js          # PostCSS é…ç½®
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

---

## ğŸ¨ æ ·å¼ç³»ç»Ÿæ¶æ„

### æ–‡ä»¶ç»„ç»‡

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | è¯´æ˜ |
|----------|------|------|
| `src/styles/main.css` | æ ¸å¿ƒæ ·å¼å…¥å£ | åŒ…å« Tailwind æŒ‡ä»¤ã€å…¨å±€é‡ç½®ã€åŠ `@layer components` é€šç”¨ç±» |
| `src/styles/variables.css` | Design Tokens | ä»…å®šä¹‰ `--engram-` å˜é‡ï¼Œè‡ªåŠ¨æ˜ å°„ä¸º Tailwind Theme |
| `*.tsx` | è§†å›¾/ç»„ä»¶æ ·å¼ | é‡‡ç”¨ **Locality of Behavior**ï¼Œç›´æ¥åœ¨ JSX ä¸­å†™ Tailwind ç±»å |

### Design Token ç³»ç»Ÿ (`variables.css`)

æ‰€æœ‰è®¾è®¡å˜é‡é›†ä¸­å®šä¹‰ï¼Œä½¿ç”¨ `--engram-` å‰ç¼€ã€‚`tailwind.config.js` ä¼šè‡ªåŠ¨é€šè¿‡ `var(--engram-...)` å¼•ç”¨è¿™äº›å˜é‡ã€‚

```css
:root {
    /* å“ç‰Œè‰² */
    --engram-primary: #f97316;
    --engram-gradient: linear-gradient(135deg, #f97316, #ec4899);
    
    /* è¯­ä¹‰è‰² */
    --engram-success: #22c55e;
    --engram-warning: #facc15;
    --engram-error: #ef4444;
    
    /* èƒŒæ™¯å±‚çº§ */
    --engram-bg-base: rgba(30, 30, 35, 0.95);
    --engram-bg-surface: rgba(255, 255, 255, 0.03);
    --engram-bg-hover: rgba(255, 255, 255, 0.05);
    
    /* é—´è· */
    --engram-space-1: 4px;
    --engram-space-2: 8px;
    /* ... æ›´å¤šå˜é‡ ... */
}
```

---

## ğŸ“ æ–°å»ºæ–‡ä»¶è§„èŒƒ

### æ–°å»ºç»„ä»¶ (Tailwind LoB æ¨¡å¼)

1. **åˆ›å»ºç»„ä»¶æ–‡ä»¶å¤¹**ï¼ˆåœ¨å¯¹åº” view çš„ `components/` ä¸‹ï¼‰ï¼š
   ```
   ComponentName/
   â”œâ”€â”€ index.tsx           # ç»„ä»¶é€»è¾‘ + å†…è”æ ·å¼
   ```

2. **ç¼–å†™ç»„ä»¶** (ç›´æ¥ä½¿ç”¨ Tailwind ç±»å):
   ```tsx
   export const MyComponent = () => (
       <div className="p-4 bg-bg-surface rounded-md border border-border-light hover:shadow-md transition-all">
           <h2 className="text-xl font-bold text-text-primary">æ ‡é¢˜</h2>
       </div>
   );
   ```

3. **ä½¿ç”¨å…±äº«æ ·å¼** (åœ¨ `main.css` ä¸­å®šä¹‰):
   ```tsx
   <button className="engram-btn engram-btn-primary">
       ä¿å­˜
   </button>
   ```

### æ–°å»ºè§†å›¾

1. **åˆ›å»ºè§†å›¾æ–‡ä»¶å¤¹**ï¼ˆåœ¨ `src/views/` ä¸‹ï¼‰ï¼š
   ```
   ViewName/
   â”œâ”€â”€ index.tsx           # è§†å›¾ä¸»ç»„ä»¶
   â””â”€â”€ components/         # è§†å›¾ä¸“å±å­ç»„ä»¶
   ```

2. **åœ¨ App.tsx ä¸­æ³¨å†Œè·¯ç”±**ã€‚

---

## ğŸ¨ CSS ç¼–å†™è§„èŒƒ

### Tailwind CSS å·¥å…·ç±»ä¼˜å…ˆ

**ä¸æ¨è (Anti-Pattern)**:
```css
/* Avoid creating custom classes unless necessary */
.card-container {
    padding: 1rem;
    background: #fff;
}
```

**æ¨è (Best Practice)**:
```tsx
/* Use utility classes directly */
<div className="p-4 bg-white rounded-lg shadow-sm">
    ...
</div>
```

### å…±äº«æ ·å¼ç±»æ¸…å• (`@layer components`)

è¿™äº›ç±»å®šä¹‰åœ¨ `src/styles/main.css` ä¸­ï¼Œç”¨äºä¿æŒ UI ä¸€è‡´æ€§ï¼š

| ç±»å | å¯¹åº” Tailwind ç»„åˆ | ç”¨é€” |
|------|-----------------------|------|
| `.engram-btn` | `inline-flex items-center ...` | åŸºç¡€æŒ‰é’®å®¹å™¨ |
| `.engram-btn-ghost` | `bg-transparent hover:bg-bg-hover ...` | å¹½çµæŒ‰é’® |
| `.engram-btn-primary` | `bg-gradient ... text-white` | ä¸»è¦æŒ‰é’® |
| `.engram-card` | `bg-bg-surface backdrop-blur-md ...` | é€šç”¨å¡ç‰‡æ ·å¼ |
| `.engram-page-header` | `flex items-center border-b ...` | é¡µé¢æ ‡é¢˜æ  |
| `.engram-icon-btn` | `w-8 h-8 flex center ...` | å›¾æ ‡æŒ‰é’® |

---

## ğŸ”‘ å…³é”®æ¨¡å—èŒè´£è¯´æ˜

### 1. `src/styles/main.css`

> **Tailwind å…¥å£ + å…±äº«ç»„ä»¶å±‚**

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **èŒè´£** | 1. å¼•å…¥ `@tailwind base/components/utilities`<br>2. å®šä¹‰å…¨å±€é‡ç½®ï¼ˆResetï¼‰<br>3. åœ¨ `@layer components` ä¸­å®šä¹‰é«˜é¢‘å¤ç”¨çš„è¯­ä¹‰åŒ–ç±»ï¼ˆå¦‚ `.engram-btn`, `.engram-card`ï¼‰ |

### 2. `src/styles/variables.css`

> **Design Token æº**

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **èŒè´£** | å®šä¹‰ CSS å˜é‡ï¼Œä½œä¸º Tailwind Theme çš„æ•°æ®æºã€‚ä¸åº”ç›´æ¥åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ `var(...)`ï¼Œè€Œåº”ä½¿ç”¨ Tailwind å·¥å…·ç±»ã€‚ |

### 3. ç»„ä»¶ä¸è§†å›¾æ–‡ä»¶ (`*.tsx`)

> **UI ä¸æ ·å¼åˆä¸€**

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **èŒè´£** | éµå¾ª **Locality of Behavior**ï¼Œå°†æ ·å¼ç›´æ¥å†™åœ¨ JSX çš„ `className` ä¸­ã€‚ä¸å†ä½¿ç”¨ `.module.css`ã€‚ |

---

## ğŸ“Š åˆ†å±‚æ¶æ„å›¾

```mermaid
graph TB
    subgraph L1 [L1: è¡¨ç°å±‚]
        UI[React Components]
        Styles[CSS Modules + Design Tokens]
    end
    
    subgraph L2 [L2: åº”ç”¨å±‚]
        Hooks[React Hooks]
    end
    
    subgraph L3 [L3: é¢†åŸŸæ ¸å¿ƒå±‚]
        Pipeline[Pipeline]
        RAG[RAG Engine]
        Manager[Managers]
    end
    
    subgraph L4 [L4: åŸºç¡€è®¾æ–½å±‚]
        EventBus[EventBus]
        Storage[Storage]
        Adapter[Adapters]
        Logger[Logger]
    end
    
    UI --> Hooks
    Styles --> UI
    Hooks --> Pipeline
    Hooks --> RAG
    Hooks --> Manager
    Pipeline --> Storage
    RAG --> Storage
    Manager --> EventBus
    Adapter --> Storage
    Logger --> EventBus
```

---

## ğŸ¨ UI èµ„æºè¯´æ˜

### Logo èµ„æº

| æ–‡ä»¶ | ç”¨é€” | ä½ç½® |
|------|------|------|
| `Engram_icon.svg` | æ‚¬æµ®çƒå›¾æ ‡ | `assets/logo/` |
| `Engram_logo.svg` | é¢æ¿å¤´éƒ¨å®Œæ•´ logo | `assets/logo/` |
| `Engram_textlogo.svg` | çº¯æ–‡å­— logo | `assets/logo/` |

### å›¾æ ‡åº“ - Lucide React

ä½¿ç”¨ [Lucide](https://lucide.dev/) ä½œä¸º UI å›¾æ ‡åº“ï¼Œæ”¯æŒ Tree-shakingï¼ŒæŒ‰éœ€å¯¼å…¥ã€‚

**ä½¿ç”¨æ–¹å¼**ï¼š
```tsx
import { X, Search, Settings, Brain, Database, Network } from 'lucide-react';

<X size={16} className={styles.closeIcon} />
```