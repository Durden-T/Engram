# Engram å·¥ç¨‹ç›®å½•ç»“æ„æŒ‡å—

> æ­¤ç›®å½•ç»“æ„åŸºäº **React + Vite + TypeScript**ï¼Œé‡‡ç”¨ **DDD (é¢†åŸŸé©±åŠ¨è®¾è®¡)** åˆ†å±‚ï¼Œå°†æ ¸å¿ƒé€»è¾‘ä¸ UI å½»åº•è§£è€¦ã€‚

---

## ğŸ“ ç›®å½•ç»“æ„æ€»è§ˆ

```
/
â”œâ”€â”€ assets/                    # é™æ€èµ„æº
â”‚   â””â”€â”€ logo/                  # Logo æ–‡ä»¶
â”‚       â”œâ”€â”€ Engram_icon.svg    # å›¾æ ‡ (æ‚¬æµ®çƒ)
â”‚       â”œâ”€â”€ Engram_logo.svg    # å®Œæ•´ logo (é¢æ¿å¤´éƒ¨)
â”‚       â””â”€â”€ Engram_textlogo.svg# æ–‡å­— logo
â”‚
â”œâ”€â”€ src/
â”‚   â”‚
â”‚   â”‚   // â•â•â• L4: åŸºç¡€è®¾æ–½å±‚ (Infrastructure) â•â•â•
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”‚   â”œâ”€â”€ bus/               # äº‹ä»¶æ€»çº¿ (RxJS)
â”‚   â”‚   â”‚   â””â”€â”€ EventBus.ts    
â”‚   â”‚   â”œâ”€â”€ storage/           # æ•°æ®åº“é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ DexieDB.ts     # IndexedDB å®ä¾‹ (Graph Storage)
â”‚   â”‚   â”‚   â””â”€â”€ VectorDB.ts    # Voy å®ä¾‹ (Vector Storage)
â”‚   â”‚   â”œâ”€â”€ logger/            # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â”‚   â””â”€â”€ index.ts       # ç»Ÿä¸€æ—¥å¿—ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ adapter/           # å¤–éƒ¨ç³»ç»Ÿé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ STBridge.ts    # SillyTavern API æ¡¥æ¥ (jQuery Hooks)
â”‚   â”‚       â””â”€â”€ LLMAdapter.ts  # ç»Ÿä¸€ LLM è°ƒç”¨æ¥å£
â”‚   â”‚
â”‚   â”‚   // â•â•â• L3: é¢†åŸŸæ ¸å¿ƒå±‚ (Domain / Core) â•â•â•
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ pipeline/          # æ•°æ®å¤„ç†æµæ°´çº¿
â”‚   â”‚   â”‚   â”œâ”€â”€ Pipeline.ts    # ç®¡é“æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ steps/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Summarizer.ts  # LLM æ€»ç»“ & å®ä½“æå–
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GraphBuilder.ts# æ„å»ºå›¾è°±èŠ‚ç‚¹ä¸è¾¹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Vectorizer.ts  # è®¡ç®— Embedding
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ rag/               # RAG æ ¸å¿ƒç®—æ³•
â”‚   â”‚   â”‚   â”œâ”€â”€ Retriever.ts   # æ··åˆæ£€ç´¢å™¨ (Graph + Vector)
â”‚   â”‚   â”‚   â””â”€â”€ Reranker.ts    # é‡æ’åºé€»è¾‘
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ manager/           # çŠ¶æ€ç®¡ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ BrainManager.ts # åˆ†è„‘é€»è¾‘ (Context Switching)
â”‚   â”‚   â”‚   â””â”€â”€ ConfigManager.ts# é…ç½®æŒä¹…åŒ–
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ types/             # é¢†åŸŸæ¨¡å‹å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ graph.d.ts     # EntityNode, EventNode å®šä¹‰
â”‚   â”‚       â””â”€â”€ events.d.ts    # ç³»ç»Ÿäº‹ä»¶å®šä¹‰
â”‚   â”‚
â”‚   â”‚   // â•â•â• L2: åº”ç”¨å±‚ (Application / Hooks) â•â•â•
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useGraphData.ts    # è®¢é˜…å›¾è°±æ•°æ® (ç”¨äº React Flow)
â”‚   â”‚   â”œâ”€â”€ useMemoryStream.ts # è®¢é˜…è®°å¿†æµ (ç”¨äºåˆ—è¡¨å±•ç¤º)
â”‚   â”‚   â””â”€â”€ useIngestion.ts    # æ§åˆ¶æ‘„å…¥çŠ¶æ€
â”‚   â”‚
â”‚   â”‚   // â•â•â• L1: è¡¨ç°å±‚ (Presentation / UI) â•â•â•
â”‚   â”œâ”€â”€ views/                 # è§†å›¾ç»„ä»¶ï¼ˆæ¯ä¸ªè§†å›¾ç‹¬ç«‹æ ·å¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ Layout/            # å¸ƒå±€å®¹å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx     
â”‚   â”‚   â”‚   â””â”€â”€ Sidebar/       
â”‚   â”‚   â”œâ”€â”€ Dashboard/         # ä»ªè¡¨ç›˜
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      
â”‚   â”‚   â”‚   â”œâ”€â”€ components/    # å­ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ styles/        # è§†å›¾ä¸“å±æ ·å¼
â”‚   â”‚   â”‚       â””â”€â”€ index.css  
â”‚   â”‚   â”œâ”€â”€ DevLog/            # å¼€å‘æ—¥å¿—ï¼ˆCSS Modulesï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      
â”‚   â”‚   â”‚   â”œâ”€â”€ LogEntryItem.tsx
â”‚   â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚   â”‚       â””â”€â”€ index.module.css
â”‚   â”‚   â”œâ”€â”€ APIPresets/        # API é¢„è®¾ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      
â”‚   â”‚   â”‚   â”œâ”€â”€ styles.css     # è§†å›¾å®¹å™¨æ ·å¼
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts       # ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ components/    # ç»„ä»¶ï¼ˆå…¨éƒ¨ CSS Modulesï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ FormField/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ styles.module.css
â”‚   â”‚   â”‚       â”œâ”€â”€ PresetCard/
â”‚   â”‚   â”‚       â”œâ”€â”€ LLMPresetForm/
â”‚   â”‚   â”‚       â”œâ”€â”€ VectorConfigForm/
â”‚   â”‚   â”‚       â””â”€â”€ RerankConfigForm/
â”‚   â”‚   â”œâ”€â”€ MemoryStream/      # è®°å¿†æµ
â”‚   â”‚   â”œâ”€â”€ GraphView/         # å›¾è°±å¯è§†åŒ–
â”‚   â”‚   â”œâ”€â”€ Brain/             # å¤§è„‘æ§åˆ¶å°
â”‚   â”‚   â””â”€â”€ Settings/          # è®¾ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx                # æ ¹ç»„ä»¶ + è·¯ç”±
â”‚   â”œâ”€â”€ main.tsx               # å…¥å£ (Mount Logic)
â”‚   â”‚
â”‚   â”‚   // â•â•â• æ ·å¼ç³»ç»Ÿ â•â•â•
â”‚   â””â”€â”€ styles/
â”‚       â”œâ”€â”€ main.css           # ä¸»å…¥å£ï¼ˆå¯¼å…¥å…¶ä»–æ¨¡å— + æ ¸å¿ƒå¸ƒå±€ï¼‰
â”‚       â”œâ”€â”€ variables.css      # Design Token ç³»ç»Ÿ
â”‚       â””â”€â”€ components.css     # å…±äº« UI ç»„ä»¶æ ·å¼
â”‚
â”œâ”€â”€ dist/                      # æ„å»ºè¾“å‡º
â”‚   â”œâ”€â”€ index.js               # æ‰“åŒ…åçš„ JS
â”‚   â””â”€â”€ style.css              # æ‰“åŒ…åçš„ CSS
â”‚
â”œâ”€â”€ docs/                      # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ manifest.json              # ST æ’ä»¶æ¸…å•
â”œâ”€â”€ vite.config.ts             # Vite é…ç½® (Library Mode)
â”œâ”€â”€ tailwind.config.js         # Tailwind é…ç½® (eg- å‰ç¼€)
â”œâ”€â”€ postcss.config.js          # PostCSS é…ç½®
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

---

## ğŸ¨ æ ·å¼ç³»ç»Ÿæ¶æ„

### æ–‡ä»¶ç»„ç»‡

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | è¡Œæ•° |
|----------|------|------|
| `src/styles/main.css` | æ ·å¼å…¥å£ + æ ¸å¿ƒå¸ƒå±€ | ~535 è¡Œ |
| `src/styles/variables.css` | Design Token ç³»ç»Ÿ | ~94 è¡Œ |
| `src/styles/components.css` | å…±äº« UI ç»„ä»¶ | ~196 è¡Œ |
| `views/*/styles/*.css` | è§†å›¾ä¸“å±æ ·å¼ | æŒ‰éœ€ |
| `components/**/styles.module.css` | ç»„ä»¶ CSS Modules | æŒ‰éœ€ |

### Design Token ç³»ç»Ÿ (`variables.css`)

æ‰€æœ‰è®¾è®¡å˜é‡é›†ä¸­å®šä¹‰ï¼Œä½¿ç”¨ `--engram-` å‰ç¼€ï¼š

```css
:root {
    /* å“ç‰Œè‰² */
    --engram-primary: #f97316;
    --engram-gradient: linear-gradient(135deg, #f97316, #ec4899);
    
    /* è¯­ä¹‰è‰² */
    --engram-success: #22c55e;
    --engram-warning: #facc15;
    --engram-error: #ef4444;
    
    /* èƒŒæ™¯å±‚çº§ */
    --engram-bg-base: rgba(30, 30, 35, 0.95);
    --engram-bg-surface: rgba(255, 255, 255, 0.03);
    --engram-bg-hover: rgba(255, 255, 255, 0.05);
    
    /* é—´è· */
    --engram-space-1: 4px;
    --engram-space-2: 8px;
    --engram-space-3: 12px;
    --engram-space-4: 16px;
    
    /* åœ†è§’ */
    --engram-radius-sm: 4px;
    --engram-radius-md: 6px;
    --engram-radius-lg: 8px;
}
```

---

## ğŸ“ æ–°å»ºæ–‡ä»¶è§„èŒƒ

### æ–°å»ºç»„ä»¶

1. **åˆ›å»ºç»„ä»¶æ–‡ä»¶å¤¹**ï¼ˆåœ¨å¯¹åº” view çš„ `components/` ä¸‹ï¼‰ï¼š
   ```
   ComponentName/
   â”œâ”€â”€ index.tsx           # ç»„ä»¶é€»è¾‘
   â””â”€â”€ styles.module.css   # ç»„ä»¶æ ·å¼ (CSS Modules)
   ```

2. **å¯¼å…¥æ ·å¼**ï¼š
   ```tsx
   import styles from './styles.module.css';
   
   export const MyComponent = () => (
       <div className={styles.container}>
           <h2 className={styles.title}>æ ‡é¢˜</h2>
       </div>
   );
   ```

3. **ä½¿ç”¨å…±äº«æ ·å¼**ï¼ˆæŒ‰é’®ã€ä¸‹æ‹‰èœå•ç­‰ï¼‰ï¼š
   ```tsx
   // å…±äº«ç±»ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œä¸éœ€è¦ import
   <button className="engram-btn engram-btn-primary">
       ä¿å­˜
   </button>
   ```

### æ–°å»ºè§†å›¾

1. **åˆ›å»ºè§†å›¾æ–‡ä»¶å¤¹**ï¼ˆåœ¨ `src/views/` ä¸‹ï¼‰ï¼š
   ```
   ViewName/
   â”œâ”€â”€ index.tsx           # è§†å›¾ä¸»ç»„ä»¶
   â”œâ”€â”€ components/         # è§†å›¾ä¸“å±å­ç»„ä»¶
   â””â”€â”€ styles/
       â””â”€â”€ index.css       # è§†å›¾æ ·å¼ï¼ˆæˆ– .module.cssï¼‰
   ```

2. **åœ¨ main.css ä¸­å¯¼å…¥**ï¼š
   ```css
   @import '../views/ViewName/styles/index.css';
   ```

3. **åœ¨ App.tsx ä¸­æ³¨å†Œè·¯ç”±**ï¼š
   ```tsx
   const ROUTES = {
       '/viewname': ViewName,
   };
   ```

---

## ğŸ¨ CSS ç¼–å†™è§„èŒƒ

### CSS Modules å‘½åè§„èŒƒ

```css
/* styles.module.css */

/* âœ… ä½¿ç”¨ camelCase */
.container { }
.formField { }
.buttonPrimary { }

/* âŒ é¿å… kebab-caseï¼ˆJS ä¸­ä¸æ–¹ä¾¿è°ƒç”¨ï¼‰ */
.form-field { }  /* éœ€è¦ styles['form-field'] */
```

### Design Token ä½¿ç”¨

```css
/* âœ… ä½¿ç”¨ Design Token */
.myComponent {
    background: var(--engram-bg-surface);
    padding: var(--engram-space-3);
    border-radius: var(--engram-radius-md);
    color: var(--engram-text-primary);
}

/* âŒ é¿å…ç¡¬ç¼–ç é¢œè‰²å€¼ */
.myComponent {
    background: rgba(255, 255, 255, 0.03);  /* åº”ä½¿ç”¨å˜é‡ */
}
```

### å…±äº«æ ·å¼ç±»æ¸…å•

| ç±»å | ç”¨é€” |
|------|------|
| `.engram-btn` | åŸºç¡€æŒ‰é’® |
| `.engram-btn-ghost` | é€æ˜æŒ‰é’® |
| `.engram-btn-primary` | ä¸»è¦æŒ‰é’®ï¼ˆæ¸å˜ï¼‰ |
| `.engram-dropdown` | ä¸‹æ‹‰èœå•å®¹å™¨ |
| `.engram-dropdown-menu` | ä¸‹æ‹‰èœå•é¢æ¿ |
| `.engram-search-box` | æœç´¢æ¡† |
| `.engram-tabs` / `.engram-tab` | æ ‡ç­¾é¡µ |
| `.engram-page-header` | é¡µé¢æ ‡é¢˜å¤´ |
| `.engram-icon-btn` | å›¾æ ‡æŒ‰é’® |

---

## ğŸ”‘ å…³é”®æ¨¡å—èŒè´£è¯´æ˜

### 1. `src/styles/main.css`

> **æ ·å¼ç³»ç»Ÿå…¥å£ + æ ¸å¿ƒå¸ƒå±€**

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **èŒè´£** | 1. å¯¼å…¥ Design Token å’Œå…±äº«ç»„ä»¶æ ·å¼<br>2. å¯¼å…¥å„è§†å›¾æ ·å¼<br>3. å®šä¹‰æ ¸å¿ƒå¸ƒå±€ï¼ˆLayout/Header/Sidebarï¼‰<br>4. å®šä¹‰å…¨å±æ¨¡å¼å’Œç§»åŠ¨ç«¯é€‚é… |

### 2. `src/styles/variables.css`

> **Design Token ç³»ç»Ÿ - å•ä¸€çœŸç›¸æ¥æº**

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **èŒè´£** | é›†ä¸­å®šä¹‰æ‰€æœ‰è®¾è®¡å˜é‡ï¼ˆé¢œè‰²ã€é—´è·ã€åœ†è§’ã€é˜´å½±ã€åŠ¨ç”»ç­‰ï¼‰ï¼Œç¡®ä¿å…¨å±€ä¸€è‡´æ€§ |

### 3. `src/styles/components.css`

> **å…±äº« UI ç»„ä»¶æ ·å¼**

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **èŒè´£** | å®šä¹‰å¯å¤ç”¨çš„é€šç”¨ç»„ä»¶æ ·å¼ï¼ˆæŒ‰é’®ã€ä¸‹æ‹‰èœå•ã€æœç´¢æ¡†ã€æ ‡ç­¾é¡µç­‰ï¼‰ï¼Œè¢«å¤šä¸ªè§†å›¾å…±äº« |

### 4. `src/views/*/styles/`

> **è§†å›¾ä¸“å±æ ·å¼**

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **èŒè´£** | æ¯ä¸ªè§†å›¾çš„ä¸“å±æ ·å¼ï¼Œä¸ä¸å…¶ä»–è§†å›¾å…±äº«ã€‚å¯ä»¥æ˜¯æ™®é€š CSS æˆ– CSS Modules |

### 5. `src/views/*/components/**/styles.module.css`

> **ç»„ä»¶ CSS Modules - è‡ªåŠ¨ä½œç”¨åŸŸéš”ç¦»**

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| **èŒè´£** | ç»„ä»¶çº§æ ·å¼ï¼Œé€šè¿‡ CSS Modules è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ç±»åï¼Œé¿å…å…¨å±€æ±¡æŸ“ |

---

## ğŸ“Š åˆ†å±‚æ¶æ„å›¾

```mermaid
graph TB
    subgraph L1 [L1: è¡¨ç°å±‚]
        UI[React Components]
        Styles[CSS Modules + Design Tokens]
    end
    
    subgraph L2 [L2: åº”ç”¨å±‚]
        Hooks[React Hooks]
    end
    
    subgraph L3 [L3: é¢†åŸŸæ ¸å¿ƒå±‚]
        Pipeline[Pipeline]
        RAG[RAG Engine]
        Manager[Managers]
    end
    
    subgraph L4 [L4: åŸºç¡€è®¾æ–½å±‚]
        EventBus[EventBus]
        Storage[Storage]
        Adapter[Adapters]
        Logger[Logger]
    end
    
    UI --> Hooks
    Styles --> UI
    Hooks --> Pipeline
    Hooks --> RAG
    Hooks --> Manager
    Pipeline --> Storage
    RAG --> Storage
    Manager --> EventBus
    Adapter --> Storage
    Logger --> EventBus
```

---

## ğŸ¨ UI èµ„æºè¯´æ˜

### Logo èµ„æº

| æ–‡ä»¶ | ç”¨é€” | ä½ç½® |
|------|------|------|
| `Engram_icon.svg` | æ‚¬æµ®çƒå›¾æ ‡ | `assets/logo/` |
| `Engram_logo.svg` | é¢æ¿å¤´éƒ¨å®Œæ•´ logo | `assets/logo/` |
| `Engram_textlogo.svg` | çº¯æ–‡å­— logo | `assets/logo/` |

### å›¾æ ‡åº“ - Lucide React

ä½¿ç”¨ [Lucide](https://lucide.dev/) ä½œä¸º UI å›¾æ ‡åº“ï¼Œæ”¯æŒ Tree-shakingï¼ŒæŒ‰éœ€å¯¼å…¥ã€‚

**ä½¿ç”¨æ–¹å¼**ï¼š
```tsx
import { X, Search, Settings, Brain, Database, Network } from 'lucide-react';

<X size={16} className={styles.closeIcon} />
```